# 企微听录音统计报表系统

## 功能说明

这个Python项目用于自动处理听录音操作日志，生成统计报表并发送到企业微信群。

### 主要功能

1. **自动检测新文件**: 监控file文件夹，自动识别当天下载的zip文件
2. **编码自动识别**: 支持多种中文编码格式（GBK、UTF-8、GB2312等）
3. **数据统计**: 按团队和个人统计听录音次数
4. **报表生成**: 生成格式化的统计报表
5. **企微集成**: 自动发送报表到企业微信群
6. **定时任务**: 支持定时自动执行

## 文件结构

```
wecom bot/
├── main.py              # 主程序
├── app.log             # 日志文件
├── file/               # 文件目录
│   ├── team_mapping.csv # 团队映射文件
│   └── *.zip          # 操作日志zip文件
└── README.md           # 说明文档
```

## 使用方法

### 1. 准备团队映射文件

在`file/team_mapping.csv`中配置账号与团队的映射关系：

```csv
团队名称,账号
客服部,KF77100064
客服部,KF77100065
销售部,KF77100066
```

### 2. 放置日志文件

将当天下载的操作日志zip文件放入`file`文件夹中，文件名需包含日期（如：`操作日志查询_KF77100064_20251118155531338.zip`）

### 3. 运行程序

#### 立即执行模式（推荐用于测试）
```bash
python main.py
```

#### 定时运行模式
```bash
python main.py --schedule
```

定时任务会在每天上午9点自动执行，每小时也会检查一次新文件。

## 配置说明

### 企业微信Webhook

在`main.py`中修改webhook_url：

```python
webhook_url = "https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=YOUR_KEY"
```

### 定时任务设置

默认设置：
- 每天上午9:00执行
- 每小时检查一次新文件

可在`main.py`的`run_scheduler()`方法中修改。

## 报表格式

生成的报表包含以下信息：
- 📊 报表标题
- 📅 统计日期
- 📁 处理文件
- 📈 总操作次数
- 🏢 各团队详细数据
- 📋 统计摘要

## 日志记录

程序运行日志保存在`app.log`中，包含：
- 文件处理状态
- 编码检测结果
- 错误信息
- 发送结果

## 依赖包

```bash
pip install requests schedule chardet
```

## 故障排除

### 1. 中文编码问题
程序会自动检测文件编码，支持多种中文编码格式。

### 2. 文件未被识别
确保zip文件名包含当天的日期（格式：YYYYMMDD）

### 3. 企微发送失败
检查webhook URL是否正确，网络连接是否正常。

## 示例输出

```
📊 听录音统计报表
📅 日期: 2025-11-18
📁 文件: 操作日志查询_KF77100064_20251118155531338.zip
📈 总操作次数: 156

🏢 客服部
  👤 张三 (KF77100064): 45次
  👤 李四 (KF77100065): 38次

🏢 销售部
  👤 王五 (KF77100066): 28次

📋 摘要:
  • 参与团队数: 2
  • 参与人数: 3
  • 平均每人: 52.0次